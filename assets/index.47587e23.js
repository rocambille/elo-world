var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,l=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&s(e,n,t[n]);if(r)for(var n of r(t))a.call(t,n)&&s(e,n,t[n]);return e},c=(e,r)=>t(e,n(r));import{r as i,p as u,R as p,b as m,N as d,e as f,S as h,a as y,H as b,c as g}from"./vendor.522fb19c.js";const E=i.exports.createContext();function v({children:e}){const[t,n]=i.exports.useState();return p.createElement(E.Provider,{value:{loginData:t,setLoginData:n}},e)}v.propTypes={children:u.exports.node.isRequired};const x=()=>i.exports.useContext(E),w=(e,t)=>{const{git:n}=t,r=c(l({},e),{err:null});switch(n){case"commit":{const{content:e}=t;return c(l({},r),{content:e,isUpToDate:!1})}case"did fetch":{const{content:e=r.content,sha:n}=t;return c(l({},r),{content:e,isFetching:!1,isUpToDate:!0,sha:n})}case"failed fetch":{const{err:e}=t;return c(l({},r),{err:e,isFetching:!1})}case"will fetch":return c(l({},r),{isFetching:!0});default:throw new Error}},N=e=>e&&`Bearer ${e}`,k={afterPull:e=>e,beforePush:e=>e,branch:"main"},T=[],C=i.exports.createContext();function D({children:e}){const{loginData:t}=x(),[n,r,o]=((e,t,n,r=k)=>{const{token:o,initialContent:a,afterPull:s,beforePush:c,branch:u}=l(l({},k),r),[{content:p,err:d,isFetching:f,isUpToDate:h,sha:y},b]=i.exports.useReducer(w,{content:a}),g=e&&t&&n&&`https://api.github.com/repos/${e}/${t}/contents/${n}`;return i.exports.useEffect((()=>{if(g){const e=g&&`${g}?ref=${u}`;b({git:"will fetch"}),fetch(e,{headers:{Authorization:N(o),Accept:"application/vnd.github.v3+json"}}).then((e=>{if(e.ok)return e.json();throw new Error})).then((({content:e,sha:t})=>{const n=m.Buffer.from(e,"base64"),r=JSON.parse(n),o=s(r);b({git:"did fetch",content:o,sha:t})})).catch((e=>b({git:"failed fetch",err:e})))}}),[s,u,g,o]),[p,e=>b({git:"commit",content:e}),{err:d,isFetching:f,isUpToDate:h,push:()=>{if(!h&&!f&&p&&y&&g){const e=c(p),t=JSON.stringify(e),r=m.Buffer.from(t).toString("base64");b({git:"will fetch"}),fetch(g,{method:"put",headers:{Authorization:N(o),"Content-Type":"application/json"},body:JSON.stringify({message:`updated ${n}`,content:r,sha:y,branch:u})}).then((e=>{if(e.ok)return e.json();throw new Error})).then((({content:{sha:e}})=>b({git:"did fetch",sha:e}))).catch((e=>b({git:"failed fetch",err:e})))}}}]})(null==t?void 0:t.username,"elo-world","data.json",{token:null==t?void 0:t.pat,initialContent:T,branch:"data"}),a=!o.isUpToDate;return p.createElement(C.Provider,{value:{movies:n,addMovie:e=>{r([...n,e])},hasSomethingToSave:a,removeMovie:({id:e})=>{r(n.filter((t=>t.id!==e)))},saveMovies:()=>{o.push()},updateMovies:(...e)=>{r(n.map((t=>{var n;return null!=(n=e.find((({id:e})=>e===t.id)))?n:t})))}}},e)}D.propTypes={children:u.exports.node.isRequired};const S=()=>i.exports.useContext(C),R={onBody:e=>e,onResponse:e=>e.json()};function P(e,t,n){const{initialState:r,onBody:o,onResponse:a}=l(l({},R),n),[s,u]=i.exports.useReducer((e=>(t,n)=>{const{type:r}=n;switch(r){case"response":{const{response:r}=n;return c(l({},t),{body:e,error:null,response:r})}case"body":{const{body:e}=n;return c(l({},t),{body:e,error:null})}case"error":{const{error:e}=n;return c(l({},t),{body:null,error:e,response:null})}default:return t}})(r),{body:r}),p=i.exports.useCallback((e=>{e&&fetch(e,t).then((e=>{if(e.ok)return u({type:"response",response:e}),a(e);throw new Error})).then((e=>{null!=e&&u({type:"body",body:o(e)})})).catch((e=>{u({type:"error",err:e})}))}),[o,a,t]);if(i.exports.useEffect((()=>{if("function"!=typeof e){p(e)}}),[p,e]),"function"==typeof e){const t=e;s.fetch=(...e)=>p(t(...e))}return s}const j={initialState:[],onBody:e=>e.results},F=i.exports.createContext();function O({children:e}){const{body:t,fetch:n}=P((e=>`https://api.themoviedb.org/3/search/movie?query=${e}&api_key=b581f37ace71546447fa00eb1e80ab57`),null,j);return p.createElement(F.Provider,{value:{results:t,setQuery:n}},e)}O.propTypes={children:u.exports.node.isRequired};const q=()=>i.exports.useContext(F);function $({opener:e,children:t}){const[n,r,o]=(()=>{const[e,t]=i.exports.useState(!1);return[e,()=>t(!0),()=>t(!1)]})();return i.exports.useEffect((()=>{const e=({key:e})=>{"Escape"===e&&o()};return n&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[o,n]),p.createElement(p.Fragment,null,p.cloneElement(e,{onClick:r}),n&&p.createElement("div",{className:"fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-75 grid",style:{gridTemplateColumns:"1fr auto 1fr",gridTemplateRows:"1fr auto 1fr"}},p.createElement("button",{className:"col-start-3 justify-self-start self-end",type:"button",onClick:o},"x"),p.createElement("div",{className:"col-start-2 row-start-2"},t)))}function M(){const e=i.exports.useRef(),t=i.exports.useRef(),{setLoginData:n}=x();return p.createElement($,{opener:p.createElement("button",{className:"link",type:"button"},"Login")},p.createElement("form",{onSubmit:r=>{r.preventDefault(),fetch("https://api.github.com",{method:"head",headers:{authorization:`Bearer ${t.current.value}`}}).then((r=>{r.ok&&"public_repo"===r.headers.get("X-OAuth-Scopes")?n({username:e.current.value,pat:t.current.value}):alert("failed to use token")}))},className:"p-4 rounded-lg bg-white space-y-4"},p.createElement("div",{className:"space-y-2"},p.createElement("label",{htmlFor:"username"},"username"),p.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:e,id:"username",type:"text"})),p.createElement("div",{className:"space-y-2"},p.createElement("label",{htmlFor:"pat"},"PAT"),p.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:t,id:"pat",type:"password"})),p.createElement("div",null,p.createElement("button",{type:"submit"},"Validate"))))}function _(){const{setLoginData:e}=x();return p.createElement("button",{className:"link",type:"button",onClick:()=>e(null)},"Logout")}function A(){const{hasSomethingToSave:e,saveMovies:t}=S();return p.createElement("button",{className:"link",type:"button",onClick:t,disabled:!e},"Save")}function B({className:e}){const{loginData:t}=x();return p.createElement("div",{className:`flex flex-row justify-end shadow-b mr-2 sm:mr-0 ${e}`},null==t?p.createElement(M,null):p.createElement(p.Fragment,null,p.createElement(A,null),p.createElement(_,null)))}$.propTypes={opener:u.exports.node.isRequired,children:u.exports.node.isRequired},B.propTypes={className:u.exports.string},B.defaultProps={className:""};const L=(e,t)=>p.createElement("li",null,p.createElement(d,{to:e,exact:!0,activeClassName:"active",className:"link"},t));function U({className:e}){return p.createElement("nav",{className:e},p.createElement("ul",{className:"flex flex-row justify-evenly sm:justify-start shadow-t sm:shadow-b"},L("/","Home"),L("/play","Play"),L("/search","Search")))}U.propTypes={className:u.exports.string},U.defaultProps={className:""};function W({children:e,data:t}){const{backdrop_path:n,elo:r,lastDelta:o,overview:a,poster_path:s,release_date:l,title:c}=t,i=null!=s?s:n;return p.createElement("figure",{className:"sm:inline-flex shadow overflow-hidden rounded-xl sm:p-0 sm:h-72"},i&&p.createElement("img",{loading:"lazy",src:`https://image.tmdb.org/t/p/w500${i}`,alt:c,className:"block sm:w-48 h-auto"}),p.createElement("figcaption",{className:"flex flex-col sm:w-96 p-4 sm:p-8 text-center sm:text-left space-y-2"},p.createElement("p",{className:"font-semibold"},c),l&&p.createElement("time",{className:"mb-2 text-gray-500"},new Date(l).getFullYear()),r&&o&&p.createElement("p",null,(e=>null==e?void 0:e.toFixed(1))(r),(e=>null==e?null:((e=e.toFixed(1))>0&&(e=`+${e}`),` (${e})`))(o)),p.createElement("p",{className:"hidden sm:line-clamp-6 sm:overflow-ellipsis"},a),e))}function z({movies:e,movieComponentType:t}){return p.createElement("ol",{className:"grid grid-cols-1 sm:grid-cols-auto-fit gap-y-4 justify-items-center"},e.map((e=>p.createElement("li",{key:e.id},p.createElement(t,{data:e})))))}function J(){const{movies:e}=S();return p.createElement(z,{movies:e.sort(((e,t)=>t.elo-e.elo||t.matchCount-e.matchCount||t.lastDelta-e.lastDelta))})}function H({data:e,onWin:t}){return p.createElement(W,{data:e},p.createElement("button",{type:"button",onClick:t},"WIN"))}W.propTypes={children:u.exports.node,data:u.exports.shape({backdrop_path:u.exports.string,elo:u.exports.number,id:u.exports.number.isRequired,lastDelta:u.exports.number,overview:u.exports.string,poster_path:u.exports.string,release_date:u.exports.string.isRequired,title:u.exports.string.isRequired}).isRequired},z.propTypes={movies:u.exports.arrayOf(W.propTypes.data).isRequired,movieComponentType:u.exports.elementType},z.defaultProps={movieComponentType:W},H.propTypes=c(l({},W.propTypes),{onWin:u.exports.func.isRequired});const I=f(),Q=()=>Math.random()-.5;function V(){const{movies:e,updateMovies:t}=S();if(e.length<10)return p.createElement("p",null,"you should start with searching movies ;)");const n=[Q,(e,t)=>{var n,r;return(null!=(n=e.matchCount)?n:0)-(null!=(r=t.matchCount)?r:0)},(e,t)=>{var n,r;return new Date(null!=(n=e.lastPlayedAt)?n:0).getTime()-new Date(null!=(r=t.lastPlayedAt)?r:0).getTime()}].sort(Q);let[r,,o]=e.sort(n[0]);return p.createElement(p.Fragment,null,p.createElement(H,{data:r,onWin:()=>{[r,o]=I(r).wins(o),t(r,o)}}),"vs",p.createElement(H,{data:o,onWin:()=>{[o,r]=I(o).wins(r),t(r,o)}}),p.createElement("button",{type:"button",onClick:()=>{[r,o]=I(r).ties(o),t(r,o)}},"=="))}function X(){const{setQuery:e}=q(),t=i.exports.useRef();return p.createElement("form",{onSubmit:n=>{n.preventDefault(),e(t.current.value)}},p.createElement("label",{htmlFor:"title"},"Title"),p.createElement("input",{ref:t,id:"title"}),p.createElement("button",{type:"submit"},"Search"))}function Y({data:e}){const{id:t}=e,{movies:n,addMovie:r,removeMovie:o}=S(),a={[!0]:{onClick:()=>o(e),text:"-"},[!1]:{onClick:()=>r(e),text:"+"}},s=null!=n.find((e=>e.id===t));return p.createElement(W,{data:e},p.createElement("button",{type:"button",onClick:a[s].onClick},a[s].text))}function G(){const{results:e}=q();return p.createElement(z,{movies:e,movieComponentType:Y})}function K(){return p.createElement(O,null,p.createElement(X,null),p.createElement(G,null))}Y.propTypes=l({},W.propTypes);const Z=(e,t)=>p.createElement(y,{exact:!0,path:e,component:t});function ee(){return p.createElement(h,null,Z("/",J),Z("/play",V),Z("/search",K))}function te(){return p.createElement(v,null,p.createElement(D,null,p.createElement(b,null,p.createElement(U,{className:"row-start-3 sm:row-auto sticky bottom-0 sm:top-0 bg-white"}),p.createElement(B,{className:"sticky top-0 bg-white"}),p.createElement("main",{className:"col-span-full p-4"},p.createElement(ee,null)))))}g.render(p.createElement(te,null),document.querySelector("#root"));
