var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,s=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,l=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&s(e,r,t[r]);if(n)for(var r of n(t))a.call(t,r)&&s(e,r,t[r]);return e},c=(e,n)=>t(e,r(n));import{r as i,p as u,R as p,b as m,N as d,e as f,S as h,a as y,H as b,c as g}from"./vendor.41b8a0a6.js";const E=i.exports.createContext();function x({children:e}){const[t,r]=i.exports.useState();return p.createElement(E.Provider,{value:{loginData:t,setLoginData:r}},e)}x.propTypes={children:u.exports.node.isRequired};const w=()=>i.exports.useContext(E),v=(e,t)=>{const{git:r}=t,n=c(l({},e),{err:null});switch(r){case"commit":{const{content:e}=t;return c(l({},n),{content:e,isUpToDate:!1})}case"did fetch":{const{content:e=n.content,sha:r}=t;return c(l({},n),{content:e,isFetching:!1,isUpToDate:!0,sha:r})}case"failed fetch":{const{err:e}=t;return c(l({},n),{err:e,isFetching:!1})}case"will fetch":return c(l({},n),{isFetching:!0});default:throw new Error}},N=e=>e&&`Bearer ${e}`,k={afterPull:e=>e,beforePush:e=>e,branch:"main"},C=[],T=i.exports.createContext();function D({children:e}){const{loginData:t}=w(),[r,n,o]=((e,t,r,n=k)=>{const{token:o,initialContent:a,afterPull:s,beforePush:c,branch:u}=l(l({},k),n),[{content:p,err:d,isFetching:f,isUpToDate:h,sha:y},b]=i.exports.useReducer(v,{content:a}),g=e&&t&&r&&`https://api.github.com/repos/${e}/${t}/contents/${r}`;return i.exports.useEffect((()=>{if(g){const e=g&&`${g}?ref=${u}`;b({git:"will fetch"}),fetch(e,{headers:{Authorization:N(o),Accept:"application/vnd.github.v3+json"}}).then((e=>{if(e.ok)return e.json();throw new Error})).then((({content:e,sha:t})=>{const r=m.Buffer.from(e,"base64"),n=JSON.parse(r),o=s(n);b({git:"did fetch",content:o,sha:t})})).catch((e=>b({git:"failed fetch",err:e})))}}),[s,u,g,o]),[p,e=>b({git:"commit",content:e}),{err:d,isFetching:f,isUpToDate:h,push:()=>{if(!h&&!f&&p&&y&&g){const e=c(p),t=JSON.stringify(e),n=m.Buffer.from(t).toString("base64");b({git:"will fetch"}),fetch(g,{method:"put",headers:{Authorization:N(o),"Content-Type":"application/json"},body:JSON.stringify({message:`updated ${r}`,content:n,sha:y,branch:u})}).then((e=>{if(e.ok)return e.json();throw new Error})).then((({content:{sha:e}})=>b({git:"did fetch",sha:e}))).catch((e=>b({git:"failed fetch",err:e})))}}}]})(null==t?void 0:t.username,"elo-world","data.json",{token:null==t?void 0:t.pat,initialContent:C,branch:"data"}),a=!o.isUpToDate;return p.createElement(T.Provider,{value:{resources:r,add:e=>{n([...r,e])},hasSomethingToSave:a,remove:({id:e})=>{n(r.filter((t=>t.id!==e)))},save:()=>{o.push()},update:(...e)=>{n(r.map((t=>{var r;return null!=(r=e.find((({id:e})=>e===t.id)))?r:t})))}}},e)}D.propTypes={children:u.exports.node.isRequired};const S=()=>i.exports.useContext(T),P={onBody:e=>e,onResponse:e=>e.json()};function R(e,t,r){const{initialState:n,onBody:o,onResponse:a}=l(l({},P),r),[s,u]=i.exports.useReducer((e=>(t,r)=>{const{type:n}=r;switch(n){case"response":{const{response:n}=r;return c(l({},t),{body:e,error:null,response:n})}case"body":{const{body:e}=r;return c(l({},t),{body:e,error:null})}case"error":{const{error:e}=r;return c(l({},t),{body:null,error:e,response:null})}default:return t}})(n),{body:n}),p=i.exports.useCallback((e=>{e&&fetch(e,t).then((e=>{if(e.ok)return u({type:"response",response:e}),a(e);throw new Error})).then((e=>{null!=e&&u({type:"body",body:o(e)})})).catch((e=>{u({type:"error",err:e})}))}),[o,a,t]);if(i.exports.useEffect((()=>{if("function"!=typeof e){p(e)}}),[p,e]),"function"==typeof e){const t=e;s.fetch=(...e)=>p(t(...e))}return s}const j={initialState:[],onBody:e=>e.results},$=i.exports.createContext();function F({children:e}){const{body:t,fetch:r}=R((e=>`https://api.themoviedb.org/3/search/movie?query=${e}&api_key=b581f37ace71546447fa00eb1e80ab57`),null,j);return p.createElement($.Provider,{value:{results:t,setQuery:r}},e)}F.propTypes={children:u.exports.node.isRequired};const O=()=>i.exports.useContext($);function q({opener:e,children:t}){const[r,n,o]=(()=>{const[e,t]=i.exports.useState(!1);return[e,()=>t(!0),()=>t(!1)]})();return i.exports.useEffect((()=>{const e=({key:e})=>{"Escape"===e&&o()};return r&&window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}}),[o,r]),p.createElement(p.Fragment,null,p.cloneElement(e,{onClick:n}),r&&p.createElement("div",{className:"fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-75 grid",style:{gridTemplateColumns:"1fr auto 1fr",gridTemplateRows:"1fr auto 1fr"}},p.createElement("button",{className:"col-start-3 justify-self-start self-end",type:"button",onClick:o},"x"),p.createElement("div",{className:"col-start-2 row-start-2"},t)))}function A(){const e=i.exports.useRef(),t=i.exports.useRef(),{setLoginData:r}=w();return p.createElement(q,{opener:p.createElement("button",{className:"link",type:"button"},"Login")},p.createElement("form",{onSubmit:n=>{n.preventDefault(),fetch("https://api.github.com",{method:"head",headers:{authorization:`Bearer ${t.current.value}`}}).then((n=>{n.ok&&"public_repo"===n.headers.get("X-OAuth-Scopes")?r({username:e.current.value,pat:t.current.value}):alert("failed to use token")}))},className:"p-4 rounded-lg bg-white space-y-4"},p.createElement("div",{className:"space-y-2"},p.createElement("label",{htmlFor:"username"},"username"),p.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:e,id:"username",type:"text"})),p.createElement("div",{className:"space-y-2"},p.createElement("label",{htmlFor:"pat"},"PAT"),p.createElement("input",{className:"focus:border-light-blue-500 focus:ring-1 focus:ring-light-blue-500 focus:outline-none w-full text-sm text-black placeholder-gray-500 border border-gray-200 rounded-md py-2 px-1",ref:t,id:"pat",type:"password"})),p.createElement("div",null,p.createElement("button",{type:"submit"},"Validate"))))}function L(){const{setLoginData:e}=w();return p.createElement("button",{className:"link",type:"button",onClick:()=>e(null)},"Logout")}function _(){const{hasSomethingToSave:e,save:t}=S();return p.createElement("button",{className:"link",type:"button",onClick:t,disabled:!e},"Save")}function B({className:e}){const{loginData:t}=w();return p.createElement("div",{className:`flex flex-row justify-end shadow-b mr-2 sm:mr-0 ${e}`},null==t?p.createElement(A,null):p.createElement(p.Fragment,null,p.createElement(_,null),p.createElement(L,null)))}q.propTypes={opener:u.exports.node.isRequired,children:u.exports.node.isRequired},B.propTypes={className:u.exports.string},B.defaultProps={className:""};const U=(e,t)=>p.createElement("li",null,p.createElement(d,{to:e,exact:!0,activeClassName:"active",className:"link"},t));function W({className:e}){return p.createElement("nav",{className:e},p.createElement("ul",{className:"flex flex-row justify-evenly sm:justify-start shadow-t sm:shadow-b"},U("/","Home"),U("/play","Play"),U("/search","Search")))}W.propTypes={className:u.exports.string},W.defaultProps={className:""};function z({children:e,data:t}){const{backdrop_path:r,elo:n,lastDelta:o,lastPlayedAt:a,matchCount:s,overview:l,poster_path:c,release_date:i,title:u}=t,m=null!=c?c:r;return p.createElement("figure",{className:"sm:inline-flex shadow overflow-hidden rounded-xl sm:p-0 sm:h-72"},m&&p.createElement("img",{loading:"lazy",src:`https://image.tmdb.org/t/p/w500${m}`,alt:u,className:"block sm:w-48 h-auto"}),p.createElement("figcaption",{className:"flex flex-col sm:w-96 p-4 sm:p-8 text-center sm:text-left space-y-2"},p.createElement("p",{className:"font-semibold"},u),i&&p.createElement("time",{className:"mb-2 text-gray-500"},new Date(i).getFullYear()),p.createElement("p",null,null!=n?((e,t,r,n)=>(e=e.toFixed(1),(r=r.toFixed(1))>0&&(r=`+${r}`),`${e} / ${t} (${r} on ${n=new Date(n).toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})`))(n,s,o,a):"newbie"),p.createElement("p",{className:"hidden sm:line-clamp-5 sm:overflow-ellipsis"},l),e))}function J({resources:e,resourceComponentType:t}){return p.createElement("ol",{className:"grid grid-cols-1 sm:grid-cols-auto-fit gap-y-4 justify-items-center"},e.map((e=>p.createElement("li",{key:e.id},p.createElement(t,{data:e})))))}function H(){const{resources:e}=S();return p.createElement(J,{resources:e.sort(((e,t)=>t.elo-e.elo||t.matchCount-e.matchCount||t.lastDelta-e.lastDelta))})}function I({data:e,onWin:t}){return p.createElement(z,{data:e},p.createElement("button",{type:"button",onClick:t},"WIN"))}z.propTypes={children:u.exports.node,data:u.exports.shape({backdrop_path:u.exports.string,elo:u.exports.number,id:u.exports.number.isRequired,lastDelta:u.exports.number,lastPlayedAt:u.exports.number,matchCount:u.exports.number,overview:u.exports.string,poster_path:u.exports.string,release_date:u.exports.string.isRequired,title:u.exports.string.isRequired}).isRequired},J.propTypes={resources:u.exports.arrayOf(z.propTypes.data).isRequired,resourceComponentType:u.exports.elementType},J.defaultProps={resourceComponentType:z},I.propTypes=c(l({},z.propTypes),{onWin:u.exports.func.isRequired});const Q=f(),M=()=>Math.random()-.5;function V(){const{resources:e,update:t}=S();if(e.length<10)return p.createElement("p",null,"you should start with searching things ;)");const r=[M,(e,t)=>{var r,n;return(null!=(r=e.matchCount)?r:0)-(null!=(n=t.matchCount)?n:0)},(e,t)=>{var r,n;return new Date(null!=(r=e.lastPlayedAt)?r:0).getTime()-new Date(null!=(n=t.lastPlayedAt)?n:0).getTime()}].sort(M);let[n,,o]=e.sort(r[0]);return p.createElement(p.Fragment,null,p.createElement(I,{data:n,onWin:()=>{[n,o]=Q(n).wins(o),t(n,o)}}),"vs",p.createElement(I,{data:o,onWin:()=>{[o,n]=Q(o).wins(n),t(n,o)}}),p.createElement("button",{type:"button",onClick:()=>{[n,o]=Q(n).ties(o),t(n,o)}},"=="))}function X(){const{setQuery:e}=O(),t=i.exports.useRef();return p.createElement("form",{onSubmit:r=>{r.preventDefault(),e(t.current.value)}},p.createElement("label",{htmlFor:"title"},"Title"),p.createElement("input",{ref:t,id:"title"}),p.createElement("button",{type:"submit"},"Search"))}function Y({data:e}){const{id:t}=e,{resources:r,add:n,remove:o}=S(),a={[!0]:{onClick:()=>o(e),text:"-"},[!1]:{onClick:()=>n(e),text:"+"}},s=null!=r.find((e=>e.id===t));return p.createElement(z,{data:e},p.createElement("button",{type:"button",onClick:a[s].onClick},a[s].text))}function G(){const{results:e}=O();return p.createElement(J,{resources:e,resourceComponentType:Y})}function K(){return p.createElement(F,null,p.createElement(X,null),p.createElement(G,null))}Y.propTypes=l({},z.propTypes);const Z=(e,t)=>p.createElement(y,{exact:!0,path:e,component:t});function ee(){return p.createElement(h,null,Z("/",H),Z("/play",V),Z("/search",K))}function te(){return p.createElement(x,null,p.createElement(D,null,p.createElement(b,null,p.createElement(W,{className:"row-start-3 sm:row-auto sticky bottom-0 sm:top-0 bg-white"}),p.createElement(B,{className:"sticky top-0 bg-white"}),p.createElement("main",{className:"col-span-full p-4"},p.createElement(ee,null)))))}g.render(p.createElement(te,null),document.querySelector("#root"));
